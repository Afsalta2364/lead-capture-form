<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NextGen Real Estate - New Client Information</title>
    <!-- Optional: Link to your custom stylesheet -->
    <!-- <link rel="stylesheet" href="css/client-form-style.css"> -->
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f0f2f6; /* Matches CRM background */
            color: #212529; /* Matches CRM text */
            display: flex;
            justify-content: center;
            align-items: flex-start; /* Align to top for longer forms */
            min-height: 100vh;
        }
        .form-container {
            max-width: 650px;
            width: 100%;
            margin: 20px;
            background-color: #FFFFFF; /* Matches CRM surface */
            padding: 30px 35px;
            border-radius: 12px; /* Matches CRM border-radius-lg */
            box-shadow: 0 3px 6px rgba(0,0,0,0.06); /* Matches CRM shadow-md */
        }
        h1 {
            text-align: center;
            color: #FF4B4B; /* CRM Primary Color */
            margin-bottom: 15px;
            font-size: 1.8em;
        }
        p.intro {
            text-align: center;
            margin-bottom: 30px;
            color: #495057; /* Matches CRM on-surface-variant-color */
            font-size: 0.95em;
            line-height: 1.6;
        }
        .form-group {
            margin-bottom: 22px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 0.9rem; /* Matches CRM form label */
            color: var(--on-surface-color);
        }
        input[type="text"],
        input[type="email"],
        input[type="tel"],
        textarea,
        select {
            width: 100%;
            padding: 0.75rem; /* Matches CRM input padding */
            border: 1px solid #DEE2E6; /* Matches CRM border-color */
            border-radius: 8px; /* Matches CRM border-radius-md */
            box-sizing: border-box;
            font-size: 0.95rem; /* Matches CRM input font-size */
            background-color: #fff; /* Matches CRM input-background */
            color: #212529; /* Matches CRM input-text-color */
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
        }
        input:focus,
        textarea:focus,
        select:focus {
            border-color: #1E88E5; /* CRM Secondary Color for focus */
            outline: 0;
            box-shadow: 0 0 0 0.2rem rgba(30, 136, 229, 0.25); /* Matches CRM input-focus-box-shadow */
        }
        select {
            appearance: none; -webkit-appearance: none; -moz-appearance: none;
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20width%3D%2220%22%20height%3D%2220%22%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%3E%3Cpath%20d%3D%22M5%208l5%205%205-5z%22%20fill%3D%22%236c757d%22/%3E%3C/svg%3E');
            background-repeat: no-repeat;
            background-position: right 0.9em top 50%;
            background-size: 0.9em auto;
            padding-right: 2.8em;
        }
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        .submit-button {
            display: block;
            width: 100%;
            background-color: #FF4B4B; /* CRM Primary Color */
            color: white;
            padding: 0.75rem 1.3rem; /* Adjusted to be closer to CRM submit button */
            border: 1px solid #FF4B4B;
            border-radius: 8px; /* Matches CRM border-radius-md */
            cursor: pointer;
            font-size: 1rem; /* Slightly larger for emphasis */
            font-weight: 500;
            transition: background-color 0.2s, border-color 0.2s;
            text-align: center;
        }
        .submit-button:hover:not(:disabled) {
            background-color: #E03030; /* CRM primary-color-dark */
            border-color: #E03030;
        }
        .submit-button:disabled {
            background-color: #e9ecef; /* Matches CRM disabled button */
            border-color: #ced4da;
            color: #6c757d;
            cursor: not-allowed;
        }
        .form-message {
            padding: 12px 15px;
            margin-top: 25px;
            border-radius: 8px; /* Matches CRM border-radius-md */
            text-align: center;
            font-size: 0.95em;
            line-height: 1.5;
        }
        .form-message.success {
            background-color: #d1e7dd; /* Softer success green */
            color: #0f5132;
            border: 1px solid #badbcc;
        }
        .form-message.error {
            background-color: #f8d7da; /* Softer error red */
            color: #842029;
            border: 1px solid #f5c2c7;
        }
        /* Small helper for required fields */
        label .required-star { color: #FF4B4B; }
    </style>
</head>
<body>
    <div class="form-container">
        <h1>New Client Information</h1>
        <p class="intro">Thank you for your interest! Please provide your details below, and one of our specialists will get in touch with you shortly.</p>

        <form id="newClientIntakeForm">
            <div class="form-group">
                <label for="clientFullName">Full Name <span class="required-star">*</span></label>
                <input type="text" id="clientFullName" name="fullName" required placeholder="e.g., Fatima Al Mansouri">
            </div>

            <div class="form-group">
                <label for="clientEmail">Email Address</label>
                <input type="email" id="clientEmail" name="email" placeholder="e.g., f.almansouri@example.com">
            </div>

            <div class="form-group">
                <label for="clientPhone">Phone Number</label>
                <input type="tel" id="clientPhone" name="phone" placeholder="e.g., +971 50 123 4567">
            </div>

            <div class="form-group">
                <label for="clientNationality">Nationality</label>
                <input type="text" id="clientNationality" name="nationality" placeholder="e.g., Emirati, British">
            </div>
            
            <div class="form-group">
                <label for="clientTypeOfClient">I am interested as a:</label>
                <select id="clientTypeOfClient" name="typeOfClient">
                    <option value="Buyer" selected>Buyer</option>
                    <option value="Seller">Seller</option>
                    <option value="Investor">Investor</option>
                    <option value="Landlord">Landlord</option>
                    <option value="Tenant">Tenant</option>
                    <option value="Other">Other</option>
                </select>
            </div>

            <!-- Optional: You could add Visa Status if relevant for client intake -->
            <!-- <div class="form-group">
                <label for="clientVisaStatus">Visa Status (if applicable):</label>
                <input type="text" id="clientVisaStatus" name="visaStatus" placeholder="e.g., Employment, Golden Visa">
            </div> -->
            
            <input type="hidden" name="source" value="Client Website Intake Form">

            <div class="form-group">
                <label for="clientNotes">Specific Property Interests or Notes:</label>
                <textarea id="clientNotes" name="notes" rows="4" placeholder="e.g., Looking for a 3-bedroom villa in Arabian Ranches, budget AED 3M."></textarea>
            </div>

            <p style="font-size: 0.8em; color: #666; margin-top: -10px; margin-bottom: 20px;">
                Fields marked with <span class="required-star">*</span> are required.
            </p>

            <button type="submit" class="submit-button" id="submitClientFormButton">Submit Information</button>
        </form>
        <div id="formResponseMessage" class="form-message" style="display:none;"></div>
    </div>

    <script>
        const GOOGLE_SCRIPT_URL = 'YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL_HERE'; // <<< IMPORTANT: REPLACE THIS!

        const clientForm = document.getElementById('newClientIntakeForm');
        const responseMessageDiv = document.getElementById('formResponseMessage');
        const submitBtn = document.getElementById('submitClientFormButton');

        clientForm.addEventListener('submit', async (event) => {
            event.preventDefault();
            if (!GOOGLE_SCRIPT_URL || GOOGLE_SCRIPT_URL === 'YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL_HERE') {
                responseMessageDiv.textContent = 'Form submission endpoint is not configured. Please contact support.';
                responseMessageDiv.className = 'form-message error';
                responseMessageDiv.style.display = 'block';
                return;
            }

            submitBtn.disabled = true;
            submitBtn.textContent = 'Submitting...';
            responseMessageDiv.style.display = 'none';
            responseMessageDiv.className = 'form-message'; // Reset classes

            const formData = new FormData(clientForm);
            
            // Optional: Convert FormData to a plain object for logging or if Apps Script needs it
            // const dataObject = {};
            // formData.forEach((value, key) => { dataObject[key] = value; });
            // console.log("Submitting data:", dataObject);

            try {
                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    body: formData 
                });

                // Try to parse JSON regardless of ok status, as Apps Script might send error details in JSON
                let result;
                try {
                    result = await response.json();
                } catch (jsonError) {
                    // If response is not JSON, create a generic error object
                    console.error("Response was not JSON:", await response.text());
                    result = { 
                        status: "error", 
                        message: `Server returned a non-JSON response. Status: ${response.status}`
                    };
                }

                if (!response.ok) { // Check for HTTP errors (4xx, 5xx)
                    throw new Error(result.message || `Server error: ${response.status}`);
                }
                
                if (result.status === 'success') {
                    responseMessageDiv.textContent = result.message || 'Your information has been submitted successfully. We will contact you shortly!';
                    responseMessageDiv.classList.add('success');
                    clientForm.reset(); // Clear the form on success
                } else {
                    responseMessageDiv.textContent = result.message || 'An error occurred while submitting your information. Please try again.';
                    responseMessageDiv.classList.add('error');
                }
            } catch (error) {
                console.error('Form submission fetch/network error:', error);
                responseMessageDiv.textContent = error.message || 'A network error occurred or the server is unavailable. Please check your connection and try again later.';
                responseMessageDiv.classList.add('error');
            } finally {
                responseMessageDiv.style.display = 'block';
                submitBtn.disabled = false;
                submitBtn.textContent = 'Submit Information';
            }
        });
    </script>
</body>
</html>
